
## [$(date +%H:%M)] Planning: Test Coverage Improvement for SmartFix

**Key Learnings:**
- SmartFix project on release_candidate branch has 51% test coverage (373 tests passing)
- Critical modules with <30% coverage: smartfix_agent.py (10%), event_loop_utils.py (13%), sub_agent_executor.py (15%)
- Project uses unittest with full mocking pattern (@patch decorators) to prevent accidental git operations
- Past issues with tests accidentally switching branches and cleaning working directory
- Canonical test command is `make test`, linting with `make lint`

**Testing Pattern Discovered:**
- Define reusable PATCHES lists (like GIT_OPERATIONS_PATCHES in test_agent_domain.py)
- Apply all patches in setUp(), stop in tearDown()
- Mock at run_command level for subprocess operations
- No real I/O, network, or git operations in tests
- Tests complete in ~2.5 seconds for 373 tests

**Architectural Decisions:**
- Organize tests by functional domain (5 domains identified)
- Target 70%+ coverage overall, focus on critical paths not 100% line coverage
- Create shared test_helpers/ directory with reusable patch lists
- Work domain-by-domain to allow parallel execution and incremental progress
- Add `make coverage` target to Makefile for coverage reporting

**Implementation Order:**
1. Makefile + Test Helpers (P0, prerequisites)
2. Agent Orchestration, Build/Test Workflow, API Integration (P1, parallel)
3. Entry Point (P2)
4. SCM Operations (P3, already has decent coverage)

**Risks Identified:**
- Accidental git operations during tests (mitigated by comprehensive mocking)
- Async test flakiness (mitigate by mocking all I/O)
- Test brittleness (test behavior not implementation)

**Branch Created:**
- AIML-TBD_test-coverage-improvement (waiting for Jira ticket ID)

